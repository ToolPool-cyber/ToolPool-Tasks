name: Tasks Manual Deploy

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: self-hosted

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Deploy with Docker
        run: |
          echo "ğŸš€ å¼€å§‹éƒ¨ç½² Tasks Distribute æœåŠ¡..."

          # --- âš™ï¸ é…ç½®åŒºåŸŸ ---
          IMAGE_NAME="tasks-distribute-image"
          CONTAINER_NAME="tasks_123"
          PORT_MAPPING="9450:9450"
          # ------------------

          echo "1. æ„å»ºæ–°é•œåƒ..."
          docker build -t $IMAGE_NAME:latest .

          echo "2. æ¸…ç†æ—§å®¹å™¨..."
          docker stop $CONTAINER_NAME || true
          docker rm $CONTAINER_NAME || true

          echo "3. å¯åŠ¨æ–°å®¹å™¨..."
          docker run -d \
            --name $CONTAINER_NAME \
            --restart always \
            -p $PORT_MAPPING \
            $IMAGE_NAME:latest

          echo "âœ… éƒ¨ç½²å®Œæˆï¼"
